# corrigÃ© du contrÃ´le 1 (2015-2016)

# SUJET A

# EX 1
# 1 
x=window(airmiles,c(1937,1),c(1955,1))
x1=diff.ts(x,lag=1,k=1)
x2=diff.ts(x1,lag=1,k=1)
x3=diff.ts(x2,lag=1,k=1)
x4=diff.ts(x3,lag=1,k=1)

# 2
par(mfrow=c(3,2))
plot(x)
plot(x1)
plot(x2)
plot(x3)
plot(x4)

# 3
# Les graphiques ne donnent pas une idÃ©e claire de l'ordre Ã  partir duquel la sÃ©rie est nulle.
# On peut aussi regarder les moyennes empiriques.
mean(x)
mean(x1)
mean(x2)
mean(x3)
mean(x4)
# Les moyennes sont toutes du mÃªme ordre Ã  partir de x2. On en dÃ©duit qu'il faut appliquer Delta deux fois pour obtenir une sÃ©rie nulle (au bruit prÃ¨s), et que donc la tendance est un polynÃ´me de degrÃ© 1.

# EX 2
# 1
x=lynx
acf(x,lag=40)
# L'ACF est pÃ©riodique de pÃ©riode (approximativement) 10. On en dÃ©duit que  x est pÃ©riodique, de pÃ©riode 10 (environ).
x=ts(x,frequency=10)

# 2
# Les oscillations sont d'amplitude Ã  peu prÃ¨s constante donc on choisit le paramÃ¨tre "additive" dans l'opÃ©ration de moyenne mobile
x_dec=decompose(x,type=c("additive"))
plot(x_dec)

# 3
length(x)
# x est de longueur=100
# Il faut choisir un k tel que 100-k est "grand". Par exemple : k=10.
# On veut faire un test de niveau 0,05 pour dÃ©cider entre 
# (H0) bruit blanc
# (H1) pas bruit blanc
k=10
Box.test(x_dec$random,lag=10)
#Le test renvoie une p-valeur < 0,05. On rejette donc l'hypothÃ¨se (H0).

#######################################################################

# SUJET B

# Ex 1
# 1
length(Nile)
# Nile est de longueur=100
# Il faut choisir un k tel que 100-k est "grand". Par exemple : k=20.
acf(Nile,lag=20)
# Le graphe a l'air presque constant. On en dÃ©duit l'existence d'une tendance linÃ©aire. Une lÃ©gÃ¨re tendance Ã  la baisse se voit aussi directement sur le graphique. 

#2
length(x)
x=sunspot.year
acf(x)
#L'acf est pÃ©riodique de pÃ©riode 10 (environ). On en dÃ©duit que x a une composante pÃ©riodique de pÃ©riode 10.

# EX 2
# 1
x=freeny.y
y=window(x,c(1962,2),c(1970,4))
# La tendance a l'air trÃ¨s stable donc on choisit un paramÃ¨tre de lissage proche de 0 (qui tient compte des observations lointaines dans les passÃ©).
yn=as.numeric(y)

# 2 et # 3 
al=0.2
err1=0
for (k in 8:34)
{
	alpha1=1-al^2
	alpha2=(1-al)/(1+al)
	ynd=yn[1:k]
	lis<-HoltWinters(ynd,alpha=alpha1,beta=alpha2,gamma=FALSE)
	p=predict(lis,n.ahead=1)
	err1=err1+(p[1]-yn[k+1])^2
}
al=0.8
err2=0
for (k in 8:34)
{
	alpha1=1-al^2
	alpha2=(1-al)/(1+al)
	ynd=yn[1:k]
	lis<-HoltWinters(ynd,alpha=alpha1,beta=alpha2,gamma=FALSE)
	p=predict(lis,n.ahead=1)
	err2=err2+(p[1]-yn[k+1])^2
}
# L'erreur quadratique est plus petite avec alpha=0,2. C'est donc ce paramÃ¨tre que l'on retient.

# 4 
al=0.2
alpha1=1-al^2
alpha2=(1-al)/(1+al)
ylisse<-HoltWinters(y,alpha=alpha1,beta=alpha2,gamma=FALSE)
p<-predict(ylisse,n.ahead=4)
plot(yliss,p)
lines(1:length(yn),yn,col='blue')

x=treering
v=as.numeric(x)
n=length(v)
k=100
l=c()
for (i in (k+1):(n-k))
{
	m=0
	for (j in (-k):k)
	{
		m=m+v[i+j]
	}
	m=m/(2k+1)
	l=c(l,m)
}
	
#######################################################################

# SUJET C

# EX 1
x=LakeHuron
x1=diff.ts(x,lag=1,k=1)
x2=diff.ts(x1,lag=1,k=1)
x3=diff.ts(x2,lag=1,k=1)
x4=diff.ts(x3,lag=1,k=1)
par(mfrow=c(3,2))
plot(x)
plot(x1)
plot(x2)
plot(x3)
plot(x4)

# Les sÃ©ries "dÃ©rivÃ©es" sont toutes du mÃªme ordre Ã  partir de x2. On en dÃ©duit qu'il faut appliquer Delta deux fois pour obtenir une sÃ©rie nulle (au bruit prÃ¨s), et que donc la tendance est un polynÃ´me de degrÃ© 0.
		
# EX 2
# 1
x=ts(treering,frequency=500)
plot(x)

#2
# On ne voit pas de pÃ©riodicitÃ©. Donc la composante pÃ©riodique est nulle. Donc un choisit un modÃ¨le avec saisonnalitÃ© additive (parce que dans le modÃ¨le avec saisonnalitÃ© multiplicative, on se retrouverait Ã  multiplier par 0).
xdec=decompose(x,type=c('additive'))
y=xdec$trend	
plot(y)

#3
yn=y[!is.na(y)]
length(yn)
# yn est de longueur=7480
# Il faut choisir un k tel que 7480-k est "grand". Par exemple : k=100.
acf(ym,lag=100).
# Le graphe a l'air presque constant. On en dÃ©duit l'existence d'une tendance linÃ©aire (qui a en fait l'air horizontale, vu le graphique).

# EX 3
# 1 
eps=rnorm(1000)
n=1000
x=c(0)
r=0
for (k in 1:n)
{
	r=0.5*r+eps[k]
	x=c(x,r)
}
plot.ts(x)

# 2
# x est de longueur=1000
# Il faut choisir un k tel que 1000-k est "grand". Par exemple : k=50.
# On veut faire un test de niveau 0,01 pour dÃ©cider entre 
# (H0) bruit blanc
# (H1) pas bruit blanc
k=50
Box.test(x,lag=k)
# On trouve une p-valeur < 0,01. On rejette donc (H0).

#######################################################################

# SUJET D

# Ex 1
# 1
x=WWWusage
par(mfrow=c(3,2))
plot(x)
x1=diff.ts(x)
plot(x1)
x2=diff.ts(x1)
plot(x2)
x3=diff.ts(x2)
plot(x3)
x4=diff.ts(x3)
plot(x4)

# 2
# Les graphiques ont tous le mÃªme ordre de grandeur Ã  partir de x1. Mais le graphe de x1 a un tÃªte diffÃ©rente des autres. Nous regardons aussi les moyennes empiriques.
mean(x)
mean(x1)
mean(x2)
mean(x3)
mean(x4)
# On en dÃ©duit que la sÃ©rie est nulle (au bruit prÃ¨s Ã  partir de x2  et que donc la sÃ©rie a pour tendance un polynÃ´me d'ordre 1.

# 3 
length(x2)
# x est de longueur=980
# Il faut choisir un k tel que 98-k est "grand". Par exemple : k=10.
# On veut faire un test de niveau 0,03 pour dÃ©cider entre 
# (H0) bruit blanc
# (H1) pas bruit blanc
k=10
Box.test(x2,lag=k)
# On trouve une p-valeur < 0,01. On rejette donc (H0).

# EX 2
#1
data=Seatbelts
x=data[,2]
length(x) #on regarde quelle est la longueur de x 
acf(x,lag.max=50)
#Le processus a une composante pÃ©riodique de pÃ©riode 12.

#2
xw=window(x,c(1969,1),c(1979,12))
#La composante pÃ©riodique est additive. On choisit des paramÃ¨tres proche de 1 car la sÃ©rie varie vite (donc on veut privilÃ©gier les observations rÃƒÂ©centes).
xlisse=HoltWinters(xw,alpha=0.9,beta=0.9,gamma=0.9,seasonal='add')
p=predict(xlisse,n.ahead=12)
plot(xlisse,p)
lines(x)


